/* cStorage 0.2.10 */
(function(a){if(typeof exports=="object"&&typeof module=="object"){module.exports=a()}else{if(typeof define=="function"&&define.amd){return define([],a)}else{(this||window).cStorage=a()}}})(function(){function a(d,c){if(!(this instanceof a)){return new a(d,c)}if(!d){throw new Error("missing function params");return false}else{this._dbname=d;this._data=b.getStorage(this._dbname);this._foundParent=this.root(c)._foundParent;this._foundChild=false;this._foundPath=[];this._foundKey=false;this._isFound=false;return this}}a.prototype.save=function(d,c,e){if(!d||typeof d!=="object"){d=this._data}if(e==undefined){e=true}if(c){b.loop(d,function(f,g){return b.encode(f[g])},e)}this._data=this._foundParent=d;this._isFound=false;window.localStorage.setItem(this._dbname,this.toString());return this};a.prototype.root=function(c){this._foundParent=this._data;this._foundKey=false;this._foundChild=false;this._foundPath=[];this._isFound=false;if(c){var d=b.getRootObjFromString(this._data,c);if(d){this._foundParent=d;this._foundPath=c.split(".");this._isFound=true}}return this};a.prototype.child=function(c,d){if(!c){return false}if(d==undefined){d=true}this._foundKey=false;this._foundChild=false;this._isFound=false;var e=b.getRootObjFromString(this._foundParent,c);if(e){this._foundParent=e;this._foundPath=this._foundPath.concat(c.split("."));this._isFound=true}return this};a.prototype.find=function(j,h){if(!j){return false}if(h==undefined){h=true}var f,g;if(typeof j==="string"||typeof j==="number"){g=f=j}else{for(var e in j){f=e;g=j[e]}}var c=this._foundParent;this._foundParent=false;this._foundKey=false;this._foundChild=false;this._isFound=false;var d=b.find(c,{key:f,value:g},h);if(d){this._foundParent=d[1];this._foundKey=d[2];this._foundChild=d[3];this._foundPath=this._foundPath.concat(d[4]);this._isFound=true}return this};a.prototype.get=function(c,e,f){var d=this._foundParent;if(c){d=b.getRootObjFromString(this._data,c)}if(e){if(f==undefined){f=true}b.loop(d,function(g,h){return b.decode(g[h])},f)}return d};a.prototype.clone=function(){return JSON.parse(JSON.stringify(this._foundParent))};a.prototype.edit=function(f){if(Object.prototype.toString.call(this._foundParent)==="[object Array]"){return this}if(!f){return this}var d=false,e=false;for(var c in f){d=c||"";e=f[c]||"";if(d){this._foundParent[d]=e}}this.save();return this};a.prototype.add=function(g,f,j){if(!g){return this}if(!j){j=true}var c=this._foundParent;var e=this;if(f){b.loop(g,function(i,l){return b.encode(i[l])},j)}var h=function(m,o){if(Object.prototype.toString.call(m)==="[object Object]"){var l=false,n=false;for(var k in o){l=k||"";n=o[k]||"";if(l){m[l]=n}}}else{if(Object.prototype.toString.call(m)==="[object Array]"){m.push(o)}}};if(Object.prototype.toString.call(g)==="[object Array]"){for(var d in g){h(c,g[d])}}else{h(c,g)}this.save();return this};a.prototype.remove=function(){if((!this._foundPath||this._foundPath.length<1)&&!this._foundParent){return false}var c=JSON.parse(JSON.stringify(this._foundPath));var d=c.pop();c=c.join(".");var e=b.getRootObjFromString(this._data,c);if(e){if(Object.prototype.toString.call(e)==="[object Array]"){e.splice(d,1);this.save()}else{if(Object.prototype.toString.call(e)==="[object Object]"){delete e[d];this.save()}}}else{return false}return this};a.prototype.map=function(e,d,c){if(!e&&typeof e!=="function"){throw new Error("missing function params");return false}if(d==undefined){d=true}b.loop(this._foundParent,e,d,c);return this};a.prototype.getValue=function(c){if(c){return b.decode(this._foundChild)}else{return this._foundChild}};a.prototype.getUid=function(e,f){if(!e){throw new Error("missing function params");return false}var c=this._foundParent;if(f==undefined){f=true}var d=false;var h=function(i){if(!d){d=parseInt(i)}else{if(d<i){d=parseInt(i)}}};var g=function(i,j,l){if(e==j){h(l)}};b.loop(c,g,f);if(!d||isNaN(d)){d=0}return parseInt(d)+1};a.prototype.toString=function(c,d,e){return JSON.stringify(this.get(c,d,e))};a.prototype.isEmpty=function(){var c=this._foundParent;if(JSON.stringify(c).replace(/[{}\[\]]/g,"")==""){return true}else{return false}};a.prototype.isFound=function(){return this._isFound};var b={getStorage:function(c){var d=window.localStorage.getItem(c)||"{}";var g={};try{g=JSON.parse(d);if(typeof g==="object"){return g}return{}}catch(f){throw new Error("non well formed json string");return{}}},encode:function(c){if(c&&typeof c==="string"){return encodeURIComponent(c)}return c},decode:function(c){if(c&&typeof c==="string"){return decodeURIComponent(c.replace(/\+/g," "))}return c},getRootObjFromString:function(e,c){if(!e){return false}var f=e;if(c){c=c.split(".");for(var d in c){f=f[c[d]]}}return f},find:function(g,e,j,i,c){if(j===true){j=999}if(c==undefined){c=0}else{c++}var d;if(Object.prototype.toString.call(g)==="[object Object]"){d="object"}else{if(Object.prototype.toString.call(g)==="[object Array]"){d="array"}else{return false}}var l=i||[];for(var f in g){if(g.hasOwnProperty(f)){if(d=="object"){if(e.key&&e.value&&f==e.key&&g[f]==e.value){return[true,g,f,g[f],l]}}else{if(d=="array"&&e.key==e.value){if(e.value&&g[f]==e.value){return[true,g,f,g[f],l]}}}if(typeof g[f]==="object"&&j&&j>=c){var h=b.find(g[f],e,j,l,c);if(h&&h[0]){l.unshift(f);return[true,h[1],h[2],h[3],h[4]]}}}}return false},loop:function(c,i,h,g){var f;if(Object.prototype.toString.call(c)==="[object Object]"){f="object"}else{if(Object.prototype.toString.call(c)==="[object Array]"){f="array"}else{return false}}for(var e in c){if(c.hasOwnProperty(e)){if(i){if(g){b.loop(c[e],function(k,j){return b.decode(k[j])},h)}var d=i(c,e,c[e]);if(d){c[e]=d}}if(typeof c[e]==="object"&&h){b.loop(c[e],i,h,g)}}}return false}};return a});
